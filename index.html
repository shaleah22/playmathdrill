<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Facts Practice</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 20px;
        }

        #question {
            font-size: 24px;
            margin-bottom: 20px;
        }

        #answer {
            font-size: 20px;
            margin-bottom: 20px;
        }

        #timer {
            font-size: 18px;
            color: red;
            margin-bottom: 20px;
            display: none;
        }

        #result {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            display: none;
        }

        .level-button {
            font-size: 18px;
            padding: 10px;
            margin-top: 10px;
            cursor: pointer;
            display: none;
        }
    </style>
</head>
<body>

<div id="question"></div>
<input type="text" id="answer" placeholder="Your answer" oninput="checkAnswer()" autofocus>
<div id="timer">Time left: <span id="time">60</span> seconds</div>
<div id="result"></div>
<button id="levelButton" class="level-button" onclick="nextLevel()">Congratulations. Click here to move to level <span id="level"></span></button>

<script>
    let mathFacts = [
        { question: "7 x 12", answer: 84 },
        { question: "8 x 12", answer: 96 },
        { question: "9 x 12", answer: 108 },
        { question: "11 x 12", answer: 132 },
        { question: "13 x 8", answer: 104 },
        { question: "13 x 9", answer: 117 },
        { question: "14 x 4", answer: 56 },
        { question: "14 x 5", answer: 70 },
        { question: "14 x 6", answer: 84 },
        { question: "14 x 7", answer: 98 },
        { question: "14 x 8", answer: 112 },
        { question: "14 x 9", answer: 126 },
        { question: "15 x 5", answer: 75 },
        { question: "15 x 7", answer: 105 },
    ];

    let currentQuestionIndex = 0;
    let correctAnswers = 0;
    let timerStarted = false;
    let timer;
    let level = parseInt(localStorage.getItem('level')) || 1;

    // Function to shuffle an array
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // Shuffle the math facts before starting the drill
    shuffleArray(mathFacts);

    function displayQuestion() {
        document.getElementById('question').innerText = mathFacts[currentQuestionIndex].question;
        document.getElementById('answer').value = '';
    }

    function startTimer() {
        let timeLeft = 60;
        document.getElementById('time').innerText = timeLeft;
        timer = setInterval(() => {
            timeLeft--;
            document.getElementById('time').innerText = timeLeft;

            if (timeLeft === 0) {
                clearInterval(timer);
                endDrill();
            }
        }, 1000);
    }

    function checkAnswer() {
        const userAnswer = parseInt(document.getElementById('answer').value);
        const resultElement = document.getElementById('result');

        if (!timerStarted) {
            // Start the timer when the user enters the first answer
            timerStarted = true;
            document.getElementById('timer').style.display = 'block';
            startTimer();
        }

        if (userAnswer === mathFacts[currentQuestionIndex].answer) {
            // If the answer is correct, move on to the next question
            correctAnswers++;
            currentQuestionIndex++;
            resultElement.style.display = 'none';
            if (currentQuestionIndex < mathFacts.length) {
                displayQuestion();
            } else {
                endDrill();
            }
        } else {
            // If the answer is incorrect, display "Try again" message
            resultElement.innerText = 'Try again.';
            resultElement.style.display = 'block';
        }
    }

    function endDrill() {
        const resultElement = document.getElementById('result');
        resultElement.innerText = `Your grade: ${((correctAnswers / mathFacts.length) * 100).toFixed(2)}%`;
        resultElement.style.display = 'block';

        if ((correctAnswers / mathFacts.length) === 1) {
            // Display the level button if the user earned 100%
            document.getElementById('levelButton').innerText = `Congratulations. Click here to move to level ${level}`;
            document.getElementById('levelButton').style.display = 'block';

            // Save the current level to local storage
            localStorage.setItem('level', level);

            // Clear the timer
            clearInterval(timer);
        }
    }

    function nextLevel() {
        // Only proceed to the next level if the user earned 100%
        if ((correctAnswers / mathFacts.length) === 1) {
            // Increment the level and reset variables for the next level
            level++;
            currentQuestionIndex = 0;
            correctAnswers = 0;
            timerStarted = false;

            // Stop the timer
            clearInterval(timer);

            // Add a new "16" fact and delete an old fact
            mathFacts.push({ question: `16 x ${level}`, answer: 16 * level });
            mathFacts.shift();

            // Shuffle the math facts for the next level
            shuffleArray(mathFacts);

            // Display the first question of the next level
            displayQuestion();

            // Hide the level button
            document.getElementById('levelButton').style.display = 'none';

            // Reset the timer
            document.getElementById('time').innerText = '60';

            // Start the timer for the next level
            startTimer();
        }
    }

    // Initial setup
    displayQuestion();
</script>

</body>
</html>
